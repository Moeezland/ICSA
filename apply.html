<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>M-ETA Application | Moeezland ICSA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#f2f6fb;
  color:#0b3058;
}
header{background:#0b3058;padding:14px 24px;}
.logo-space{width:220px;height:42px;}
.container{
  max-width:760px;
  margin:50px auto;
  background:#fff;
  padding:36px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.hidden{display:none;}
.field{margin-bottom:18px;}
label{display:block;font-weight:600;margin-bottom:6px;}
input,select{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
}
small{color:#555;}
.btn{
  background:#0b3058;
  color:#fff;
  border:none;
  padding:12px 22px;
  border-radius:10px;
  cursor:pointer;
}
.error-box{
  background:#fdeaea;
  border-left:5px solid #c62828;
  padding:20px;
  border-radius:8px;
  margin-top:20px;
  color:#8a1c1c;
}
.declaration{
  background:#f7f9fc;
  border:1px solid #d6e0ea;
  padding:20px;
  border-radius:10px;
  margin-top:24px;
}
.declaration-grid{
  display:grid;
  grid-template-columns:20px 1fr;
  gap:14px;
}
.declaration-text{font-size:14px;line-height:1.6;}
</style>
</head>

<body>

<header>
  <div class="logo-space"></div>
</header>

<div class="container">

<div id="page1">
  <h1>Apply for M-ETA</h1>
  <button class="btn" onclick="showForm()">Get started</button>
</div>

<form id="form2" class="hidden">

<h2>Personal information</h2>

<div class="field">
  <label>Full legal name *</label>
  <input id="fullName" required>
</div>

<div class="field">
  <label>Date of birth *</label>
  <input id="dob" type="date" required>
</div>

<div class="field">
  <label>Country of residence *</label>
  <select id="country" required>
    <option value="">Select</option>
    <option>Japan</option>
    <option>Singapore</option>
    <option>South Korea</option>
    <option>Switzerland</option>
    <option>Sweden</option>
    <option>Denmark</option>
    <option>Norway</option>
    <option>Germany</option>
    <option>France</option>
    <option>Italy</option>
    <option>Spain</option>
    <option>United Kingdom</option>
    <option>Canada</option>
    <option>Australia</option>
    <option>New Zealand</option>
    <option>TÃ¼rkiye</option>
    <option>Malaysia</option>
    <option>Indonesia</option>
    <option>Jordan</option>
    <option>Egypt</option>
    <option>Palestine</option>
    <option>Saudi Arabia</option>
    <option>Pakistan</option>
    <option>India</option>
    <option>United States</option>
  </select>
</div>

<div class="field">
  <label>Email *</label>
  <input id="email" type="email" required>
</div>

<div class="field">
  <label>Discord username</label>
  <input id="discord" placeholder="username#0000">
  <small>Optional but recommended</small>
</div>

<div class="declaration">
  <div class="declaration-grid">
    <input type="checkbox" id="declare" required>
    <div class="declaration-text">
      I declare that the information provided is true and complete.
      I understand false information may result in refusal or restrictions.
    </div>
  </div>
</div>

<div id="eligibilityError" class="error-box hidden">
  <strong>Your country of residence is currently not eligible for M-ETA.</strong><br><br>
  You are required to obtain a <strong>Visa on Arrival</strong> at the Capital Territory of Moeezland.<br><br>
  <strong>Location:</strong><br>
  25Â°01'26.3"N 67Â°07'28.8"E
</div>

<button class="btn" type="submit">Submit application</button>
</form>

</div>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCs-pheSxe9bkAqnhG9qOjF7RvFfb9k00A",
  authDomain: "e-civilian-portal2007.firebaseapp.com",
  projectId: "e-civilian-portal2007"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const approvedCountries = [
  "Japan","Singapore","South Korea","Switzerland","Sweden","Denmark","Norway",
  "Germany","France","Italy","Spain","United Kingdom","Canada","Australia",
  "New Zealand","TÃ¼rkiye","Malaysia","Indonesia","Jordan","Egypt","Palestine","Saudi Arabia"
];

function showForm(){
  document.getElementById("page1").classList.add("hidden");
  document.getElementById("form2").classList.remove("hidden");
}

document.getElementById("form2").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const country = country.value;
  const errorBox = document.getElementById("eligibilityError");
  errorBox.classList.add("hidden");

  if (!approvedCountries.includes(country)) {
    errorBox.classList.remove("hidden");
    return;
  }

  await addDoc(collection(db, "applications"), {
    fullName: fullName.value.trim(),
    dob: dob.value,
    country,
    email: email.value.trim(),
    discord: discord.value.trim(),
    declarationAccepted: true,
    status: "Submitted",
    submittedAt: serverTimestamp()
  });

  alert("Application submitted successfully.");
});
</script>

</body>
</html>
